# 计算机网络

- [计算机网络](#计算机网络)
  - [TCP](#tcp)
    - [主机到主机（Host-To-Host）](#主机到主机host-to-host)
    - [连接（Connection）](#连接connection)
    - [双工](#双工)
    - [可靠性](#可靠性)
    - [TCP 的握手和挥手](#tcp-的握手和挥手)
      - [TCP 协议的基本操作](#tcp-协议的基本操作)
      - [建立连接的过程（三次握手）](#建立连接的过程三次握手)
      - [断开连接的过程（4 次挥手）](#断开连接的过程4-次挥手)
      - [TCP 为什么是 3 次握手，4 次挥手？](#tcp-为什么是-3-次握手4-次挥手)
  - [RESTful(Representational State Transfer)](#restfulrepresentational-state-transfer)
    - [http url对外暴露](#http-url对外暴露)
    - [XML/JSON格式定义](#xmljson格式定义)
    - [METHOD对应请求的行为](#method对应请求的行为)
    - [无状态](#无状态)
    - [幂等性](#幂等性)

## TCP

    TCP（Transport Control Protocol）是一个传输层协议，提供 Host-To-Host 数据的可靠传输，支持全双工，是一个连接导向的协议。

### 主机到主机（Host-To-Host）

    TCP 提供的是 Host-To-Host 传输，一台主机通过 TCP 发送数据给另一台主机。
    TCP 协议往上是应用到应用（Application-To-Application）的协议。端口号用于区分应用。
    TCP 不负责实际地址到地址（Address-To-Address）的传输，因此 TCP 协议把 IP 地址给底层的互联网层处理。

### 连接（Connection）

    连接是通信双方的一个约定，目标是让两个在通信的程序之间产生一个默契，保证两个程序都在线，而且尽快地响应对方的请求，这就是连接（Connection）。
    连接是传输层的概念。
    会话是应用的行为。连接会断开，聊天窗口没关，会话还在。

### 双工

    任何时刻数据都可以双向收发，这就是全双工，全双工需要大于 1 条线路。
    这里的线路，是一个抽象概念，可以并发地处理信号，达到模拟双工的目的。

### 可靠性

    可靠性指数据保证无损传输。如果发送方按照顺序发送，然后数据无序地在网络间传递，就必须有一种算法在接收方将数据恢复原有的顺序。

### TCP 的握手和挥手

    TCP 是一个连接导向的协议，设计有建立连接（握手）和断开连接（挥手）的过程。

#### TCP 协议的基本操作

  - 如果一个 Host 主动向另一个 Host 发起连接，称为 SYN（Synchronization），请求同步；
  - 如果一个 Host 主动断开请求，称为 FIN（Finish），请求完成；
  - 如果一个 Host 给另一个 Host 发送数据，称为 PSH（Push），数据推送。

    以上 3 种情况，接收方收到数据后，都需要给发送方一个 ACK（Acknowledgement）响应。请求/响应的模型是可靠性的要求，如果一个请求没有响应，发送方可能会认为自己需要重发这个请求。

#### 建立连接的过程（三次握手）

    因为要保持连接和可靠性约束，TCP 协议要保证每一条发出的数据必须给返回，返回数据叫作 ACK（也就是响应）。

  - 客户端发消息给服务端（SYN）**（1）**
  - 服务端准备好进行连接
  - 服务端针对客户端的 SYN 给一个 ACK **（2）**
  - 因为服务端还没有确定客户端是否准备好了。服务端马上给客户端发送数据，这个时候客户端可能还没有准备好接收数据。因此还需要增加下面过程
  - 服务端发送一个 SYN 给客户端 **（2）**
  - 客户端准备就绪
  - 客户端给服务端发送一个 ACK **（3）**

#### 断开连接的过程（4 次挥手）

  - 客户端要求断开连接，发送一个断开的请求，这个叫作（FIN） **（1）**
  - 服务端收到请求，然后给客户端一个 ACK，作为 FIN 的响应 **（2）**
  - 这个时候服务端不能马上传 FIN，因为断开连接要处理的问题比较多，比如说服务端可能还有发送出去的消息没有得到 ACK；也有可能服务端自己有资源要释放。因此断开连接不能像握手那样操作——将两条消息合并
  - 服务端经过一个等待，确定可以关闭连接了，再发一条 FIN 给客户端 **（3）**
  - 客户端收到服务端的 FIN，同时客户端也可能有自己的事情需要处理完，比如客户端有发送给服务端没有收到 ACK 的请求，客户端自己处理完成后，再给服务端发送一个 ACK **（4）**

#### TCP 为什么是 3 次握手，4 次挥手？

    TCP 是一个双工协议，为了让双方都保证，建立连接的时候，连接双方都需要向对方发送 SYC（同步请求）和 ACK（响应）。
    握手阶段双方都没有烦琐的工作，因此一方向另一方发起同步（SYN）之后，另一方可以将自己的 ACK 和 SYN 打包作为一条消息回复，因此是 3 次握手——需要 3 次数据传输。
    到了挥手阶段，双方都可能有未完成的工作。收到挥手请求的一方，必须马上响应（ACK），表示接收到了挥手请求。类比现实世界中，你收到一个 Offer，出于礼貌你先回复考虑一下，然后思考一段时间再回复 HR 最后的结果。最后等所有工作结束，再发送请求中断连接（FIN），因此是 4 次挥手。

## RESTful(Representational State Transfer)

### http url对外暴露

```http
http(s)://域名:端口[/版本]/资源路径/变量
```

### XML/JSON格式定义

    参数和返回结果使用XML/JSON格式化。

### METHOD对应请求的行为

| METHOD | 行为  |
| :----: | :---: |
|  GET   | 查询  |
|  POST  | 增加  |
|  PUT   | 更新  |
| DELETE | 删除  |

### 无状态

    客户端与服务端之间的交互在请求之间是无状态的，从客户端到服务端的每个请求都必须包含理解请求所必需的信息。

### 幂等性

    多次重复请求时，接口能保证与预期相符的结果。