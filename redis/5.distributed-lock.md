# Redis 分布式锁

- [Redis 分布式锁](#redis-分布式锁)
  - [分布式锁问题](#分布式锁问题)
    - [高可用问题](#高可用问题)
    - [获取锁和释放锁必须为同一对象](#获取锁和释放锁必须为同一对象)
    - [互斥语义](#互斥语义)
    - [锁超时](#锁超时)
    - [扩展](#扩展)
      - [获知锁的释放](#获知锁的释放)
      - [允许同一个对象多次获取锁](#允许同一个对象多次获取锁)
  - [Redis 实现分布式锁](#redis-实现分布式锁)
  - [缺陷](#缺陷)

## 分布式锁问题

### 高可用问题

- 哨兵模式
- cluster 模式

### 获取锁和释放锁必须为同一对象

- 需记录持锁对象

### 互斥语义

- 确保锁只被一个对象持有

### 锁超时

- 避免持锁对象异常退出，锁得不到释放

### 扩展

#### 获知锁的释放

- 公平锁
- 非公平锁

#### 允许同一个对象多次获取锁

- 重入锁
- 非重入锁

## Redis 实现分布式锁

```shell
set lock uuid nx ex 10

if uuid == ?
  del lock
```

## 缺陷

- 主从复制是异步操作，数据易丢失
- 只能实现非公平锁
